<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oylama Seçenekleri</title>
    <style>
        .bar {
            height: 30px;
            background-color: lightblue;
            margin: 5px 0;
            transition: width 0.5s;
        }
        .bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
        }
        #results {
            display: none;
            margin-top: 20px;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBVystHty1ALLeWWAeAJ0bgZo8H4xLVUMw",
            authDomain: "prostanligioylama.firebaseapp.com",
            projectId: "prostanligioylama",
            storageBucket: "prostanligioylama.appspot.com",
            messagingSenderId: "98986974707",
            appId: "1:98986974707:web:f12c5054ac11df6b81c686",
            measurementId: "G-902EF2BKZT"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function vote(option) {
            const userName = localStorage.getItem('userName');
            if (!userName) {
                alert("Lütfen önce adınızı girin.");
                return;
            }

            const votesRef = ref(database, 'votes/' + option);
            set(votesRef, (votes) => (votes || 0) + 1);

            // Kullanıcı ismini sakla
            const userVotesRef = ref(database, 'users/' + userName);
            set(userVotesRef, { option: option });

            displayResults();
        }

        function displayResults() {
            const votesRef = ref(database, 'votes');
            onValue(votesRef, (snapshot) => {
                const votes = snapshot.val() || {};
                const totalVotes = Object.values(votes).reduce((a, b) => a + b, 0);
                
                for (let i = 1; i <= 3; i++) {
                    const voteCount = votes[i] || 0;
                    const percentage = totalVotes ? (voteCount / totalVotes) * 100 : 0;
                    document.getElementById(`bar${i}`).style.width = `${percentage}%`;
                    document.getElementById(`result${i}`).innerText = `${i}. Seçenek: ${voteCount} oy (${percentage.toFixed(2)}%)`;
                }
                document.getElementById('results').style.display = 'block';
            });
        }

        window.onload = displayResults;
    </script>
</head>
<body>
    <h1>Oylama Seçenekleri</h1>
    <div id="user-info">
        <input type="text" id="name" placeholder="İsim" required>
        <button onclick="submitUserInfo()">Devam Et</button>
    </div>
    <div id="vote-section" style="display:none;">
        <button onclick="vote(1)">1. ADY Makoto</button>
        <div class="bar-container">
            <div id="bar1" class="bar" style="width: 0%;"></div>
        </div>
        <button onclick="vote(2)">2. MET Lusyon</button>
        <div class="bar-container">
            <div id="bar2" class="bar" style="width: 0%;"></div>
        </div>
        <button onclick="vote(3)">3. TETA Sezar</button>
        <div class="bar-container">
            <div id="bar3" class="bar" style="width: 0%;"></div>
        </div>
    </div>

    <div id="results">
        <h2>Sonuçlar</h2>
        <p id="result1">1. ADY Makoto: 0 oy (0.00%)</p>
        <p id="result2">2. MET Lusyon: 0 oy (0.00%)</p>
        <p id="result3">3. TETA Sezar: 0 oy (0.00%)</p>
    </div>

    <script>
        function submitUserInfo() {
            const name = document.getElementById('name').value.trim();
            if (name === '') {
                alert("Lütfen isminizi girin.");
                return;
            }

            localStorage.setItem('userName', name);
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('vote-section').style.display = 'block';
        }
    </script>
</body>
</html>
